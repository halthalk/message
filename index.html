<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halthalk-Ù…Ù†ØµØ© Ø­Ù„ØªÙ‡Ø§Ù„Ùƒ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* ================================================= */
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        /* ================================================= */

        body { 
            margin: 0; 
            padding: 0; 
            font-family: 'Cairo', Arial, sans-serif; 
            background: #ffffff;
            color: #14171a;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            transition: background 0.3s, color 0.3s;
        }
        body.dark-mode {
            background: #15202b;
            color: #ffffff;
        }
        body.dark-mode .header {
            background: #15202b;
            border-bottom: 1px solid #38444d;
        }
        body.dark-mode .sidebar {
            background: #15202b;
            border-right: 1px solid #38444d;
        }
        body.dark-mode .sidebar .menu-item {
            color: #ffffff;
        }
        body.dark-mode .sidebar .menu-item:hover {
            background: #1e2732;
        }
        body.dark-mode .welcome-section h1 {
            color: #ffffff;
        }
        body.dark-mode .tribute-text {
            color: #ffffff;
        }
        body.dark-mode .stat-title {
            color: #8899a6;
        }
        body.dark-mode .footer {
            color: #8899a6;
        }
        body.dark-mode .logo {
            display: none;
        }
        body.dark-mode .logo-dark {
            display: block;
        }
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: #ffffff;
            border-bottom: 1px solid #e1e8ed;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
        }
        
        /* Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù‚Ø¯ÙŠÙ… (Nav-links) */
        .nav-links {
            display: none !important; 
        }
        
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ø²Ø± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± (Ù„Ù… ÙŠØ¹Ø¯ Ù…Ø³ØªØ®Ø¯Ù…Ø§Ù‹ ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± Ù…Ø¨Ø§Ø´Ø±Ø© Ù„ÙƒÙ† Ù†Ø­Ø§ÙØ¸ Ø¹Ù„ÙŠÙ‡) */
        #reportLinkHeader {
             color: #FF0000; /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ */
        }
        #reportLinkHeader:hover {
             background-color: rgba(255, 0, 0, 0.1); 
        }

        .logo {
            width: 120px;
            height: 60px;
            object-fit: contain;
        }
        .logo-dark {
            width: 120px;
            height: 60px;
            object-fit: contain;
            display: none;
        }
        .theme-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1da1f2;
            border: none;
            color: #ffffff;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
            margin-left: 10px;
        }
        .theme-toggle:hover {
            background: #0d95e8;
        }
        .sidebar {
            position: fixed;
            left: 0;
            top: 70px;
            width: 250px;
            height: calc(100vh - 70px);
            background: #ffffff;
            border-right: 1px solid #e1e8ed;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        .sidebar .menu-item {
            display: block;
            padding: 12px 0;
            color: #14171a;
            text-decoration: none;
            border-radius: 8px;
            transition: background 0.2s;
            cursor: pointer;
        }
        .sidebar .menu-item:hover {
            background: #f5f8fa;
        }
        .sidebar .menu-item i {
            margin-left: 10px;
        }
        .main-content {
            margin-left: 250px;
            margin-top: 70px;
            padding: 20px;
            max-width: 600px;
        }
        .welcome-section {
            text-align: center;
            margin-bottom: 30px;
        }
        .welcome-section h1 {
            color: #14171a;
            font-size: 2em;
            margin-bottom: 10px;
        }
        .buttons-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ±Ø© */
        .button-group {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù‡Ø§ Ø¨Ø§Ù„Ù†Ø²ÙˆÙ„ Ù„Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
            margin-bottom: 10px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        }

        .button {
            display: inline-block;
            padding: 12px 24px;
            margin: 10px 5px;
            font-size: 0.9em;
            color: #ffffff;
            background: #1da1f2;
            border: none;
            border-radius: 20px;
            text-decoration: none;
            transition: background 0.3s;
            cursor: pointer;
            text-align: center; /* Ù„Ø¶Ù…Ø§Ù† ØªÙ…Ø±ÙƒØ² Ø§Ù„Ù†Øµ */
        }
        .button:hover {
            background: #0d95e8;
        }
        .floating-button {
            position: relative;
            animation: float 3s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(29, 161, 242, 0.5);
            background: linear-gradient(45deg, #1da1f2, #0d95e8);
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 1em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px; /* ÙØµÙ„Ù‡ Ø¹Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù„ÙŠ ØªØ­ØªÙ‡ */
        }
        .floating-button:hover {
            box-shadow: 0 0 30px rgba(29, 161, 242, 0.8);
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .tribute-text {
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
            color: #14171a;
            margin: 20px 0;
            line-height: 1.5;
        }
        .universities-section {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .university-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            animation: float 3s ease-in-out infinite;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .university-image:hover {
            transform: scale(1.1);
        }
        .stats-container {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .stat-item {
            text-align: center;
            margin: 10px;
        }
        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #1da1f2;
        }
        .stat-title {
            color: #657786;
            font-size: 0.9em;
        }
        .footer {
            text-align: center;
            margin-top: 50px;
            color: #657786;
            font-size: 0.8em;
        }
        .footer a {
            color: #1da1f2;
            text-decoration: none;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        
        /* ================================================= */
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© */
        /* ================================================= */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .main-content {
                margin-left: 0;
            }
            .universities-section {
                gap: 10px;
            }
            
            /* --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù…Ø±ÙƒØ²Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ --- */
            /* Ù„Ù… ØªØ¹Ø¯ Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙˆÙ„ÙƒÙ† Ù†Ø¨Ù‚ÙŠÙ‡Ø§ Ø§Ø­ØªÙŠØ§Ø·Ø§Ù‹ ÙÙŠ Ø­Ø§Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Dropdown */
            .header-dropdown {
                left: initial; 
                right: initial; 
                top: 65px; 
                transform: translateX(-50%); 
                margin-left: 50%; 
                width: 90%; 
                max-width: 300px;
            }
            /* ----------------------------------------------------- */
        }
        
        /* ================================================= */
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø²Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± */
        /* ================================================= */
        
        /* Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙƒØ§Ù† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ù„Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©) */
        .nav-actions {
            position: relative;
            display: flex;
            align-items: center;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        #optionsToggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: none;
            border: none;
            color: #1da1f2;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        #optionsToggle:hover {
            background-color: rgba(29, 161, 242, 0.1);
        }
        
        body.dark-mode #optionsToggle {
            color: #ffffff;
        }
        body.dark-mode #optionsToggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* ================================================= */
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Modal (Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´ÙØ§ÙØ© ÙˆØ§Ù„Ø¶Ø¨Ø§Ø¨ÙŠØ©) */
        /* ================================================= */
        
        .modal {
            display: none; 
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4); /* Ø´ÙØ§ÙÙŠØ© Ø£Ø³Ø§Ø³ÙŠØ© */
            backdrop-filter: blur(8px); /* ØªØ£Ø«ÙŠØ± Ø¶Ø¨Ø§Ø¨ÙŠ Ù‚ÙˆÙŠ Ù„Ù„Ø®Ù„ÙÙŠØ© */
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.5);
            animation: modalopen 0.4s;
            position: relative;
        }
        body.dark-mode .modal-content {
            background-color: #1e2732;
            color: #ffffff;
        }
        @keyframes modalopen {
            from {opacity: 0; transform: scale(0.8);}
            to {opacity: 1; transform: scale(1);}
        }
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            left: 15px;
            top: 10px;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: #1da1f2;
            text-decoration: none;
            cursor: pointer;
        }
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø®Ø§ØµØ© Ø¨Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø®ÙŠØ§Ø±Ø§Øª */
        #notificationModal .modal-content, #optionsModal .modal-content {
             max-width: 400px;
             text-align: center;
             padding: 40px 20px;
        }


        /* ================================================= */
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Modal Ø£Ø¶Ù Ø´ÙŠØ¡ / ØªÙ‚Ø±ÙŠØ± */
        /* ================================================= */
        .modal-content h2 {
            text-align: center;
            color: #1da1f2;
            margin-bottom: 20px;
        }
        .modal-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .modal-form input[type="text"],
        .modal-form textarea {
            width: 95%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            resize: vertical;
            background-color: #f9f9f9;
        }
        body.dark-mode .modal-form input[type="text"],
        body.dark-mode .modal-form textarea {
            background-color: #2a313d;
            border: 1px solid #38444d;
            color: #ffffff;
        }
        .modal-form button {
            background-color: #1da1f2;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            transition: background-color 0.2s;
        }
        .modal-form button:hover {
            background-color: #0d95e8;
        }

        /* ================================================= */
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Telegram-like Chat */
        /* ================================================= */

        :root {
            --telegram-blue: #229ED9;
            --telegram-dark-blue: #1D7AFC;
            --background-dark: #1a1f27;
            --text-light: #ffffff;
            --text-secondary: #b8c1d1;
            --input-bg: rgba(255, 255, 255, 0.1);
            --bubble-self-bg: linear-gradient(135deg, #1da1f2, #0d95e8); /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ù…ÙˆØ­Ø¯ */
            --bubble-other-bg: rgba(255, 255, 255, 0.15);
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ */
            --light-chat-bg: #f5f5f5;
            --light-list-bg: rgba(255, 255, 255, 0.9);
            --light-text-color: #14171a;
            --light-secondary-text: #657786;
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        body.dark-mode .chat-popup-container .popup-content, 
        body.dark-mode .chat-messages {
            background: linear-gradient(180deg, #0f1419 0%, var(--background-dark) 100%);
        }
        body.dark-mode .chat-item:hover, body.dark-mode .chat-item.active {
            background: rgba(34, 158, 217, 0.2);
        }
        body.dark-mode .message.other .message-content {
            background: var(--bubble-other-bg);
        }
        body.dark-mode .input-container {
            background: rgba(26, 31, 39, 0.95);
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        body:not(.dark-mode) .chat-popup-container .popup-content {
            background: var(--light-list-bg); /* Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© ÙØ§ØªØ­Ø© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø§Øª */
            border: 1px solid #e1e8ed;
        }
        body:not(.dark-mode) .chat-messages {
            background: var(--light-chat-bg); /* Ø®Ù„ÙÙŠØ© ØµÙØ­Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ÙØ§ØªØ­Ø© */
        }
        
        /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø¬Ø¹Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø£Ø­Ù…Ø± ØºØ§Ù…Ù‚ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ */
        body:not(.dark-mode) .chat-name {
            color: #8B0000; 
        }

        body:not(.dark-mode) .chat-item {
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        body:not(.dark-mode) .chat-item:hover, body:not(.dark-mode) .chat-item.active {
            background: rgba(29, 161, 242, 0.1);
            border-right: 4px solid var(--telegram-blue);
        }
        body:not(.dark-mode) .last-message {
            color: var(--light-secondary-text); 
        }
        body:not(.dark-mode) .messages-header {
            color: white; 
        }
        body:not(.dark-mode) .input-container {
             background: rgba(255, 255, 255, 0.95);
             border-top: 1px solid #e1e8ed;
        }
        body:not(.dark-mode) .message-input-area {
            background: #f0f0f0;
        }
        body:not(.dark-mode) .message-input {
            color: var(--light-text-color);
        }
        body:not(.dark-mode) .action-btn {
            color: var(--light-secondary-text);
        }
        body:not(.dark-mode) .message-content {
            background: var(--bubble-self-bg);
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        body:not(.dark-mode) .message.other .message-content {
            background: #e6e6e6; 
            color: var(--light-text-color);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border: none;
        }

        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„/Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .page-hidden .header, .page-hidden .sidebar, .page-hidden .main-content {
            display: none !important;
        }


        .chat-popup-container { /* ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¹Ø§Ø±Ø¶ */
            display: none; /* ÙŠØªÙ… Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù‡ Ø¹Ø¨Ø± JS */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5); /* Ù„Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ¹ØªÙŠÙ… ÙˆØ§Ù„Ø¶Ø¨Ø§Ø¨ÙŠØ© */
            backdrop-filter: blur(8px); /* ØªØ£Ø«ÙŠØ± Ø¶Ø¨Ø§Ø¨ÙŠ Ù‚ÙˆÙŠ Ù„Ù„Ø®Ù„ÙÙŠØ© */
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .popup-content {
            /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„ÙØ§ØªØ­ */
            margin: 2% auto;
            padding: 0;
            border-radius: 15px;
            width: 95%;
            max-width: 420px;
            height: 90%;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            border: 1px solid #2a2f3a;
        }
        .header-chat {
            background: linear-gradient(90deg, var(--telegram-blue) 0%, var(--telegram-dark-blue) 100%);
            color: white;
            padding: 18px;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .chat-list {
            list-style: none;
            height: calc(100% - 70px);
            overflow-y: auto;
            padding: 10px 0;
        }
        .chat-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            /* border-bottom ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„ÙØ§ØªØ­ */
        }
        
        /* Ù„ÙˆÙ† Ø§Ø³Ù… Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† (Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ø£Ø¨ÙŠØ¶) */
        body.dark-mode .chat-name {
            color: var(--text-light); 
        }

        .avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            margin-left: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 22px;
            font-weight: bold;
            background: var(--bubble-self-bg);
            box-shadow: 0 4px 12px rgba(34, 158, 217, 0.3);
            flex-shrink: 0;
        }
        .chat-info {
            flex: 1;
            min-width: 0;
        }
        .chat-name {
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .last-message {
            /* Ø§Ù„Ù„ÙˆÙ† ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„ÙØ§ØªØ­ */
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .chat-messages {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Ø§Ù„Ø®Ù„ÙÙŠØ© ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„ÙØ§ØªØ­ */
            background: rgba(0, 0, 0, 0.5); /* Ø£Ø³Ø§Ø³ Ø´ÙØ§ÙÙŠØ© Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
            backdrop-filter: blur(8px); /* ØªØ£Ø«ÙŠØ± Ø¶Ø¨Ø§Ø¨ÙŠ Ù‚ÙˆÙŠ Ù„Ù„Ø®Ù„ÙÙŠØ© */
            z-index: 1001;
            overflow: hidden;
        }
        .messages-header {
            background: linear-gradient(90deg, var(--telegram-blue) 0%, var(--telegram-dark-blue) 100%);
            color: white;
            padding: 18px 20px;
            font-size: 18px;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 20;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .back-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 22px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 50%;
            margin-left: 10px;
            transition: all 0.2s;
        }
        .message-list {
            padding: 20px;
            height: calc(100% - 110px); 
            overflow-y: auto;
            padding-bottom: 100px;
        }
        .message {
            margin-bottom: 16px;
            display: flex;
            justify-content: flex-end;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
            transform: translateY(10px);
        }
        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }
        .message-content {
            /* Ø§Ù„Ø®Ù„ÙÙŠØ© ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„ÙØ§ØªØ­ */
            padding: 12px 18px;
            border-radius: 18px 18px 5px 18px;
            max-width: 75%;
            word-wrap: break-word;
            font-size: 15px;
            line-height: 1.4;
            position: relative;
        }
        
        .message-attachment-info {
            display: block;
            font-size: 12px;
            color: rgba(255,255,255,0.8);
            margin-top: 5px;
            text-align: right; 
        }
        
        .message.other {
            justify-content: flex-start !important;
        }
        .message.other .message-content {
            /* Ø§Ù„Ø®Ù„ÙÙŠØ© ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„ÙØ§ØªØ­ */
            border-radius: 18px 18px 18px 5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        body:not(.dark-mode) .message.other .message-content .message-attachment-info {
            color: #444; 
        }
        .message.other .message-content .message-attachment-info {
            text-align: left; 
        }

        .attachment-preview {
            margin-top: 5px;
            display: flex;
            flex-direction: column; 
        }
        .attachment-preview img {
            max-width: 100%;
            max-height: 200px;
            display: block;
            border-radius: 10px;
            margin-bottom: 8px;
        }
        
        .attachment-preview .voice-note {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.2);
            padding: 8px;
            border-radius: 20px;
            max-width: 100%;
        }
        .attachment-preview .voice-note.other {
            /* Ø§Ù„Ø®Ù„ÙÙŠØ© ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„ÙØ§ØªØ­ */
            background: rgba(255, 255, 255, 0.1);
        }
        body:not(.dark-mode) .attachment-preview .voice-note.other {
            background: rgba(0, 0, 0, 0.1);
        }
        body:not(.dark-mode) .attachment-preview .voice-duration {
            color: #333;
        }


        .attachment-preview .voice-play-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--text-light);
            color: var(--telegram-blue);
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            flex-shrink: 0;
            padding: 0;
        }
        .attachment-preview .voice-timeline {
            flex-grow: 1;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 2.5px;
            position: relative;
        }
        .attachment-preview .voice-progress {
            width: 0%;
            height: 100%;
            background: var(--text-light);
            border-radius: 2.5px;
        }
        .attachment-preview .voice-duration {
            font-size: 12px;
            color: var(--text-light);
            flex-shrink: 0;
            width: 35px;
            text-align: center;
        }

        .attachment-preview audio {
            display: none !important;
        }


        .attachment-preview .file-card {
            background: rgba(0, 0, 0, 0.15);
            padding: 10px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        body:not(.dark-mode) .attachment-preview .file-card {
            background: rgba(0, 0, 0, 0.05);
        }
        body:not(.dark-mode) .attachment-preview .file-card-name {
            color: #14171a;
        }
        body:not(.dark-mode) .attachment-preview .file-card-size {
            color: #657786;
        }

        .attachment-preview .file-card-icon {
            font-size: 24px;
            margin-left: 10px;
            color: var(--telegram-blue);
        }
        .attachment-preview .file-card-info {
            flex-grow: 1;
        }
        .attachment-preview .file-card-name {
            font-weight: bold;
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .attachment-preview .file-card-size {
            font-size: 12px;
            color: var(--text-secondary);
        }
        .attachment-preview .preview-file-btn {
            background: var(--telegram-dark-blue);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }
        
        .delete-btn {
            background: none; 
            border: none; 
            color: #ff5252;
            font-size: 14px; 
            margin-right: 5px; 
            opacity: 0.7; 
            cursor: pointer; 
            transition: opacity 0.2s, transform 0.2s;
            align-self: flex-end;
            padding: 0;
            line-height: 1;
        }
        .delete-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        .message .message-content-wrapper {
            display: flex;
            align-items: flex-end;
        }


        .input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            /* Ø§Ù„Ø®Ù„ÙÙŠØ© ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„ÙØ§ØªØ­ */
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            /* Ø§Ù„Ø­Ø¯ÙˆØ¯ ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„ÙØ§ØªØ­ */
            z-index: 30;
            display: flex;
        }
        .input-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            width: 100%;
        }
        .message-input-area {
            flex: 1;
            display: flex;
            align-items: flex-end;
            /* Ø§Ù„Ø®Ù„ÙÙŠØ© ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„ÙØ§ØªØ­ */
            border-radius: 25px;
            padding: 8px 16px;
        }
        .message-input {
            flex: 1;
            background: none;
            border: none;
            /* Ø§Ù„Ù„ÙˆÙ† ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„ÙØ§ØªØ­ */
            font-size: 16px;
            padding: 12px 0;
            outline: none;
            resize: none;
            max-height: 120px; 
            line-height: 1.4;
        }
        
        .action-btn {
            background: none;
            border: none;
            /* Ø§Ù„Ù„ÙˆÙ† ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„ÙØ§ØªØ­ */
            font-size: 20px;
            cursor: pointer;
            padding: 0 5px;
            align-self: center;
            transition: color 0.2s;
        }
        .action-btn:hover {
            color: var(--telegram-blue);
        }
        
        #attachment-btn {
            order: -1; 
            font-size: 25px;
            padding: 0 5px 0 10px;
        }
        
        .send-btn {
            background: var(--bubble-self-bg);
            border: none;
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(34, 158, 217, 0.4);
            flex-shrink: 0;
        }
        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        #attachment-menu {
            position: absolute;
            bottom: 80px;
            right: 20px;
            background: #2a313d;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            padding: 10px;
            display: none;
            z-index: 35;
        }
        body:not(.dark-mode) #attachment-menu {
            background: #ffffff;
            border: 1px solid #e1e8ed;
        }
        .attachment-option {
            padding: 10px;
            color: var(--text-light);
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
        }
        body:not(.dark-mode) .attachment-option {
             color: #14171a;
        }
        .attachment-option:hover {
            background: #3c4656;
        }
        body:not(.dark-mode) .attachment-option:hover {
            background: #f5f8fa;
        }
        .attachment-icon {
            font-size: 20px;
            margin-left: 10px;
            width: 20px;
        }

        #recording-indicator {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 31, 39, 0.95);
            z-index: 40;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            flex-direction: column;
            backdrop-filter: blur(5px);
        }
        body:not(.dark-mode) #recording-indicator {
            background: rgba(255, 255, 255, 0.95);
            color: #14171a;
        }
        .recording-dot {
            width: 10px;
            height: 10px;
            background: red;
            border-radius: 50%;
            animation: pulse 1s infinite;
            margin-bottom: 10px;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        #stop-recording-btn {
            margin-top: 15px;
            padding: 10px 20px;
            background: var(--telegram-blue);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        
        #preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1100;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        .preview-content {
            background: #1a1f27;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 350px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: right;
            color: white;
        }
        body:not(.dark-mode) .preview-content {
             background: #ffffff;
             color: #14171a;
        }
        .preview-header {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }
        body:not(.dark-mode) .preview-header {
            border-bottom: 1px solid #e1e8ed;
        }
        #preview-media {
            margin-bottom: 15px;
            max-width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 8px;
            display: block;
            margin: 10px auto;
        }
        .preview-caption-input {
            width: 100%;
            background: #2a313d;
            border: none;
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            resize: none;
            outline: none;
        }
        body:not(.dark-mode) .preview-caption-input {
            background: #f0f0f0;
            color: #14171a;
        }
        .preview-buttons {
            display: flex;
            justify-content: space-between;
        }
        .preview-buttons button {
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        #cancel-preview {
            background: #3c4656;
            color: white;
        }
        body:not(.dark-mode) #cancel-preview {
            background: #e1e8ed;
            color: #14171a;
        }
        #send-preview {
            background: var(--telegram-blue);
            color: white;
        }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: rgba(34, 158, 217, 0.5); border-radius: 3px; }
        body:not(.dark-mode) ::-webkit-scrollbar-thumb { background: rgba(29, 161, 242, 0.8); }

    </style>
</head>
<body>
    <div class="header">
        <div class="nav-actions">
            <button id="optionsToggle" title="Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª"><i class="fas fa-ellipsis-v"></i></button>
            
            </div>
        <div style="display: flex; align-items: center;">
            <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>
            <img src="https://github.com/elmoftary-vr/Halthalk/raw/4a1dc7ecbb8371080b183f1b7b720d2a29fff926/20251205_163046.png" alt="Logo" class="logo">
            <img src="https://raw.githubusercontent.com/elmoftary-vr/Halthalk/3232d9c52d6dcba5f5d43b88b317e503e6682d8a/20251206_234458.png" alt="Logo Dark" class="logo-dark">
        </div>
    </div>

    <div class="sidebar">
        <a href="#" class="menu-item"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="https://search-halthalk.vercel.app/" class="menu-item" target="_blank" rel="noopener noreferrer"><i class="fas fa-search"></i> Ø§Ù„Ø§Ø³ØªÙƒØ´Ø§Ù</a>
        <a href="#" class="menu-item" id="notificationLinkSidebar"><i class="fas fa-bell"></i> Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</a>
        <a href="#" class="menu-item" id="messagesLinkSidebar"><i class="fas fa-envelope"></i> Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</a>
        <a href="https://t.me/Halthalkrobot" class="menu-item" target="_blank" rel="noopener noreferrer"><i class="fas fa-user"></i> ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù…</a>
        <a href="https://t.me/Halthalk" class="menu-item" target="_blank" rel="noopener noreferrer"><i class="fas fa-info-circle"></i> Ù‚Ù†Ø§ØªÙ†Ø§ Ø§Ù„Ø±Ø³Ù…ÙŠØ©</a>
        <a href="#" class="menu-item" id="reportLinkSidebar"><i class="fas fa-bug"></i> Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± / Ù…Ù„Ø§Ø­Ø¸Ø©</a>
        <a href="#" class="menu-item" id="addThingSidebarBtn"><i class="fas fa-plus"></i> Ø£Ø¶Ù Ø´ÙŠØ¡</a> </div>

    <div class="main-content">
        <div class="welcome-section">
            <h1>Ø§Ù‡Ù„Ø§ Ø¨Ùƒ Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ Ù…Ù†ØµØ© Ø­Ù„ØªÙ‡Ø§Ù„Ùƒ</h1>
            <p> Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§ÙƒØ¨Ø± Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙÙŠ Ù…ØµØ± !</p>
        </div>

        <div class="buttons-section">
            <a href="https://halthalk.eyoo.org/" class="button floating-button">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†ØµØ©</a>
            
            <div class="button-group">
                <a href="https://t.me/A_Dk_A" class="button" style="background: #e91e63;" target="_blank" rel="noopener noreferrer">Ù†Ø¸Ø§Ù… Ù„ØºØ§Øª</a>
                <a href="https://t.me/MA6_Z" class="button" style="background: #ff9800;" target="_blank" rel="noopener noreferrer">Ù†Ø¸Ø§Ù… Ø£Ø²Ù‡Ø±ÙŠ</a>
            </div>

            <div class="button-group">
                <a href="https://t.me/Halthalkrobot" class="button" target="_blank" rel="noopener noreferrer">ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù…</a>
                <a href="https://t.me/Halthalk" class="button" target="_blank" rel="noopener noreferrer">ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ù†ØµØ©</a>
            </div>

        </div>

        <div class="tribute-text">
            Ù†Ø­Ù† Ù†ÙƒÙ† ÙƒÙ„ Ø§Ù„ÙØ¶Ù„ ÙˆØ§Ù„Ø­Ø¨ Ù„Ø£Ø³Ø§ØªØ°Ø© ÙƒØ§Ù†ÙˆØ§ Ø³Ø¨Ø¨Ù‹Ø§ ÙÙŠ Ø¥Ø´Ø¹Ø§Ù„ Ù†Ø§Ø± Ø§Ù„Ø£Ù…Ù„ ÙˆØ§Ù„Ù…Ø«Ø§Ø¨Ø±Ø©ØŒ ÙˆØ£ÙŠØ¶Ù‹Ø§ Ù‡Ù… Ø£Ø¹Ù…Ø¯Ø© Ø´Ø§Ù…Ø®Ø© ÙÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª Ø§Ù„Ø¢ØªÙŠØ©.
        </div>

        <div class="universities-section">
            <a href="https://www.muc.edu.eg/ar" target="_blank" rel="noopener noreferrer">
                <img src="https://raw.githubusercontent.com/elmoftary-vr/Halthalk/18be8bf95d514ff1448b40890a9145e82628b6bd/20251205_210105.png" alt="Ø¬Ø§Ù…Ø¹Ø©" class="university-image">
            </a>
            <a href="https://www.asu.edu.eg/ar" target="_blank" rel="noopener noreferrer">
                <img src="https://github.com/elmoftary-vr/Halthalk/raw/84bc7dc1984df945100ecfe600e0c6b6110b9417/20251205_211025.png" alt="Ø¬Ø§Ù…Ø¹Ø©" class="university-image">
            </a>
            <a href="https://cu.edu.eg/ar/Home" target="_blank" rel="noopener noreferrer">
                <img src="https://raw.githubusercontent.com/elmoftary-vr/Halthalk/b4c9610765891680e50029774974ec149952b1dd/20251205_210532.png" alt="Ø¬Ø§Ù…Ø¹Ø©" class="university-image">
            </a>
            <a href="https://www.helwan.edu.eg/" target="_blank" rel="noopener noreferrer">
                <img src="https://github.com/elmoftary-vr/Halthalk/blob/1d2589a3948597faac405d7c496ec7b3f039ab18/20251205_205841.png?raw=true" alt="Ø¬Ø§Ù…Ø¹Ø©" class="university-image">
            </a>
        </div>

        <div class="stats-container">
            <div class="stat-item">
                <div class="stat-number" id="dailyVisits">0+</div>
                <div class="stat-title">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="totalMembers">0+</div>
                <div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="activeStudents">0+</div>
                <div class="stat-title">Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</div>
            </div>
        </div>

        <div class="footer">
            <a href="https://t.me/HalthalkBot" target="_blank" rel="noopener noreferrer">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© 2026</a>
        </div>
    </div>
    
    <div id="optionsModal" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center; padding: 40px 20px;">
            <span class="close-btn" onclick="closeOptionsModal()">&times;</span>
            <i class="fas fa-bars" style="font-size: 50px; color: #1da1f2; margin-bottom: 20px;"></i>
            <h2 style="font-size: 1.5em; color: #1da1f2;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h2>
            <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;">
                 <a href="https://search-halthalk.vercel.app/" class="button" style="background: #1da1f2; margin: 0; padding: 12px 24px;" target="_blank" rel="noopener noreferrer" onclick="closeOptionsModal()"><i class="fas fa-search"></i> Ø§Ù„Ø§Ø³ØªÙƒØ´Ø§Ù</a>
                 <a href="#" class="button" id="messagesLinkOptions" style="background: #1da1f2; margin: 0; padding: 12px 24px;" onclick="closeOptionsModal()"><i class="fas fa-envelope"></i> Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</a>
                 <a href="#" class="button" id="reportLinkOptions" style="background: #ff5252; margin: 0; padding: 12px 24px;" onclick="closeOptionsModal()"><i class="fas fa-bug"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
                 <a href="#" class="button" id="addThingOptionsBtn" style="background: #28a745; margin: 0; padding: 12px 24px;" onclick="closeOptionsModal()"><i class="fas fa-plus"></i> Ø£Ø¶Ù Ø´Ø¦</a>
            </div>
        </div>
    </div>
    
    <div id="addThingModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeAddThingModal()">&times;</span>
            <h2><i class="fas fa-plus-circle"></i> Ø£Ø¶Ù Ø´ÙŠØ¡ Ø¬Ø¯ÙŠØ¯</h2>
            <p style="text-align: center; margin-bottom: 20px; color: #1da1f2;">Ø´Ø§Ø±Ùƒ Ù…Ø­ØªÙˆÙ‰ ØªØ¹Ù„ÙŠÙ…ÙŠØŒ Ø³Ø¤Ø§Ù„ØŒ Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­!</p>
            <form id="addThingForm" class="modal-form">
                <label for="thingTitle">Ø§Ø³Ù…Ùƒ:</label>
                <input type="text" id="thingTitle" name="thingTitle" required>

                <label for="thingLink">ÙƒÙ… Ø¹Ù…Ø±Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                <input type="text" id="thingLink" name="thingLink">

                <label for="thingDescription">Ø§Ù„ÙˆØµÙ / Ø§Ù„ØªÙØ§ØµÙŠÙ„:</label>
                <textarea id="thingDescription" name="thingDescription" rows="5" required></textarea>

                <button type="submit"><i class="fas fa-share-square"></i> Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</button>
            </form>
        </div>
    </div>
    
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeReportModal()">&times;</span>
            <h2><i class="fas fa-bug"></i> ØªÙ‚Ø±ÙŠØ± / Ù…Ù„Ø§Ø­Ø¸Ø© ÙÙ†ÙŠØ©</h2>
            <p style="text-align: center; margin-bottom: 20px; color: #ff5252;">Ø£Ø¨Ù„Øº Ø¹Ù† Ø®Ø·Ø£ØŒ Ø£Ùˆ Ø£Ø±Ø³Ù„ Ù…Ù„Ø§Ø­Ø¸Ø© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡!</p>
            <form id="reportForm" class="modal-form">
                <label for="reporterName">Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                <input type="text" id="reporterName" name="reporterName">

                <label for="issueType">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© / Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:</label>
                <input type="text" id="issueType" name="issueType" placeholder="Ù…Ø«Ù„: Ø®Ø·Ø£ ÙÙŠ Ø²Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŒ Ø§Ù‚ØªØ±Ø§Ø­ Ø¥Ø¶Ø§ÙØ© Ø®Ø§ØµÙŠØ©..">

                <label for="reportDescription">Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©:</label>
                <textarea id="reportDescription" name="reportDescription" rows="5" required></textarea>

                <button type="submit" style="background: #ff5252;"><i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
            </form>
        </div>
    </div>

    <div id="notificationModal" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center; padding: 40px 20px;">
            <span class="close-btn" onclick="closeNotificationModal()">&times;</span>
            <i class="fas fa-bell" style="font-size: 50px; color: #1da1f2; margin-bottom: 20px;"></i>
            <h2 style="font-size: 1.5em; color: #1da1f2;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ùƒ Ø§Ù„Ø¢Ù†</h2>
            <p style="color: #657786;">ØªØ­Ù‚Ù‚ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù„ØªØ±Ù‰ Ø¢Ø®Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙˆØ§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ.</p>
        </div>
    </div>
    
    <div id="popup" class="chat-popup-container">
        <div class="popup-content">
            <div class="header-chat">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div> 
            <ul class="chat-list">
                <li class="chat-item active" onclick="showMessages('important', this)">
                    <div class="avatar"><i class="fas fa-bullhorn"></i></div> 
                    <div class="chat-info">
                        <div class="chat-name">ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù‡Ø§Ù…Ø©</div>
                        <div class="last-message">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</div>
                    </div>
                </li>
                <li class="chat-item" onclick="showMessages('owner', this)">
                    <div class="avatar"><i class="fas fa-user-tie"></i></div>
                    <div class="chat-info">
                        <div class="chat-name">Ù…Ø§Ù„Ùƒ Ù…Ù†ØµØ© Ø­Ù„ØªÙ‡Ø§Ù„Ùƒ</div>
                        <div class="last-message" id="owner-last-message">ÙØ®ÙˆØ± Ø¨ÙŠÙƒ Ø¬Ø¯Ø§Ù‹ ğŸ¥°</div>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <div id="messages" class="chat-messages">
        <div class="messages-header">
            <button class="back-btn" onclick="backToList()">&#8592;</button>
            <span id="chat-title">Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</span>
        </div>
        
        <div class="message-list" id="message-list"></div>
        
        <div id="recording-indicator">
            <div class="recording-dot"></div>
            <p>Ø¬Ø§Ø±Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„... <span id="recording-timer">00:00</span></p>
            <button id="stop-recording-btn" onclick="stopRecording()">Ø¥ÙŠÙ‚Ø§Ù ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© <i class="fas fa-square"></i></button>
        </div>

        <div class="input-container" id="message-input-container" style="display: none;">
            <div class="input-wrapper">
                <button class="action-btn" id="attachment-btn" onclick="toggleAttachmentMenu()"><i class="fas fa-paperclip"></i></button>
                <div class="message-input-area">
                    <textarea class="message-input" id="message-input" 
                            placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." 
                            rows="1" 
                            onkeydown="handleKeyPress(event)"></textarea>
                    <button class="action-btn" id="voice-btn" onclick="startRecording()"><i class="fas fa-microphone"></i></button>
                </div>
                <button class="send-btn" id="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
            </div>
            
            <div id="attachment-menu">
                <label for="image-upload" class="attachment-option">
                    <span class="attachment-icon"><i class="fas fa-image"></i></span> ØµÙˆØ±Ø©
                    <input type="file" id="image-upload" accept="image/*" onchange="handleAttachment(event, 'image')" style="display: none;">
                </label>
                <label for="file-upload" class="attachment-option">
                    <span class="attachment-icon"><i class="fas fa-file"></i></span> Ù…Ù„Ù
                    <input type="file" id="file-upload" accept="*" onchange="handleAttachment(event, 'file')" style="display: none;">
                </label>
            </div>
        </div>
    </div>
    
    <div id="preview-modal">
        <div class="preview-content">
            <div class="preview-header">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø±ÙÙ‚</div>
            <div id="preview-placeholder">
            </div>
            <textarea class="preview-caption-input" id="preview-caption" placeholder="Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)..."></textarea>
            <div class="preview-buttons">
                <button id="cancel-preview" onclick="closePreviewModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button id="send-preview" onclick="sendAttachment()">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && (e.key === 'c' || e.key === 'C' || e.key === 'v' || e.key === 'V' || e.key === 'a' || e.key === 'A')) {
                // e.preventDefault(); // ØªÙ… Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ù„Ù…Ù†Ø¹ Ù…Ù†Ø¹ Ø§Ù„Ù€ Paste ÙÙŠ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            }
        });

        function animateCounter(element, target, duration) {
            let start = 0;
            const increment = target / (duration / 10);
            const timer = setInterval(() => {
                start += increment;
                if (start >= target) {
                    start = target;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(start) + '+';
            }, 10);
        }

        const themeToggleMain = document.getElementById('themeToggle');
        const body = document.body;

        function syncTheme(isDark) {
            if (isDark) {
                body.classList.add('dark-mode');
                themeToggleMain.querySelector('i').className = 'fas fa-sun';
            } else {
                body.classList.remove('dark-mode');
                themeToggleMain.querySelector('i').className = 'fas fa-moon';
            }
             localStorage.setItem('darkMode', isDark);
        }

        window.addEventListener('load', () => {
            animateCounter(document.getElementById('dailyVisits'), 2651, 3000);
            animateCounter(document.getElementById('totalMembers'), 500000, 3000);
            animateCounter(document.getElementById('activeStudents'), 120000, 3000);
            
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            syncTheme(isDarkMode);
        });

        themeToggleMain.addEventListener('click', () => {
            const isDark = !body.classList.contains('dark-mode');
            syncTheme(isDark);
        });
        
        // =================================================
        // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ Modal Ø£Ø¶Ù Ø´ÙŠØ¡
        // =================================================
        const addThingModal = document.getElementById('addThingModal');
        const addThingForm = document.getElementById('addThingForm');
        
        const messagesLinkSidebar = document.getElementById('messagesLinkSidebar');
        const addThingSidebarBtn = document.getElementById('addThingSidebarBtn');
        const chatPopup = document.getElementById('popup');
        const telegramChatMessages = document.getElementById('messages');

        // =================================================
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ Options Modal
        // =================================================
        const optionsModal = document.getElementById('optionsModal');
        const optionsToggle = document.getElementById('optionsToggle');
        const messagesLinkOptions = document.getElementById('messagesLinkOptions');
        const addThingOptionsBtn = document.getElementById('addThingOptionsBtn');
        const reportLinkOptions = document.getElementById('reportLinkOptions');
        
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        const notificationModal = document.getElementById('notificationModal');
        const notificationLinkSidebar = document.getElementById('notificationLinkSidebar');
        
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
        const reportModal = document.getElementById('reportModal');
        const reportForm = document.getElementById('reportForm');
        const reportLinkSidebar = document.getElementById('reportLinkSidebar');
        const reportLinkHeader = document.getElementById('reportLinkHeader'); // Ø§Ù„Ø²Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± (ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¢Ù†)

        // ØªØ¹Ø±ÙŠÙ Ø§Ù„ØªÙˆÙƒÙ† ÙˆÙ…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªÙ„Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù€ 'Ø£Ø¶Ù Ø´ÙŠØ¡'
        const ADD_THING_BOT_TOKEN = '8102433429:AAEWLBKx68nh19kWG9sEFMqFP4_cgRF9GcE'; // ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆÙƒÙ†
        const ADD_THING_CHAT_ID = '7428842238'; // ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ ID
        
        // ØªØ¹Ø±ÙŠÙ Ø§Ù„ØªÙˆÙƒÙ† ÙˆÙ…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªÙ„Ù… Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ± (ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ…)
        const REPORTING_BOT_TOKEN = '8102433429:AAEWLBKx68nh19kWG9sEFMqFP4_cgRF9GcE'; 
        const REPORTING_CHAT_ID = '7428842238'; 


        function openAddThingModal(e) {
            if (e) e.preventDefault();
            closeChat(null); // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø£ÙˆÙ„Ø§Ù‹
            closeNotificationModal(); // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            closeReportModal(); // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            closeOptionsModal(); // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
            addThingModal.style.display = 'flex';
            body.classList.add('page-hidden');
        }

        function closeAddThingModal() {
            addThingModal.style.display = 'none';
            body.classList.remove('page-hidden');
        }

        addThingForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('thingTitle').value.trim(); 
            const age = document.getElementById('thingLink').value.trim(); 
            const description = document.getElementById('thingDescription').value.trim();
            const currentTime = new Date().toLocaleString('ar-EG', { timeZone: 'Africa/Cairo' });

            const message = `
**[âœ… Ø·Ù„Ø¨ Ø¥Ø¶Ø§ÙØ©/Ø§Ù‚ØªØ±Ø§Ø­ Ø¬Ø¯ÙŠØ¯]**
* **Ø§Ù„ÙˆÙ‚Øª (EET):** ${currentTime}
* **Ø§Ù„Ø§Ø³Ù…:** ${name}
* **Ø§Ù„Ø¹Ù…Ø±:** ${age || 'Ù„Ù… ÙŠØ­Ø¯Ø¯'}
* **Ø§Ù„ØªÙØ§ØµÙŠÙ„:** ${description}
`;
            
            sendTextToTelegram(message, ADD_THING_BOT_TOKEN, ADD_THING_CHAT_ID).then(() => {
                alert('Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.');
                addThingForm.reset();
                closeAddThingModal();
            }).catch(() => {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠØ¯ÙˆÙŠØ§Ù‹.');
            });
        });

        // =================================================
        // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ Modal Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± 
        // =================================================

        function openReportModal(e) {
            if (e) e.preventDefault();
            closeChat(null); 
            closeAddThingModal(); 
            closeNotificationModal(); 
            closeOptionsModal(); // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
            reportModal.style.display = 'flex';
            body.classList.add('page-hidden');
        }

        function closeReportModal() {
            reportModal.style.display = 'none';
            body.classList.remove('page-hidden');
        }

        reportForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('reporterName').value.trim(); 
            const type = document.getElementById('issueType').value.trim(); 
            const description = document.getElementById('reportDescription').value.trim();
            const currentTime = new Date().toLocaleString('ar-EG', { timeZone: 'Africa/Cairo' });

            const message = `
**[âš ï¸ ØªÙ‚Ø±ÙŠØ± ÙÙ†ÙŠ / Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©]**
* **Ø§Ù„ÙˆÙ‚Øª (EET):** ${currentTime}
* **Ø§Ù„Ù…Ø±Ø³Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):** ${name || 'Ù…Ø¬Ù‡ÙˆÙ„'}
* **Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** ${type || 'Ù„Ù… ÙŠØ­Ø¯Ø¯'}
* **Ø§Ù„ØªÙØ§ØµÙŠÙ„:** ${description}
`;
            
            sendTextToTelegram(message, REPORTING_BOT_TOKEN, REPORTING_CHAT_ID).then(() => {
                alert('Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ³ÙŠØªÙ… Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡.');
                reportForm.reset();
                closeReportModal();
            }).catch(() => {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.');
            });
        });


        // =================================================
        // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ Modal Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        // =================================================

        function openNotificationModal(e) {
            if (e) e.preventDefault();
            closeChat(null);      // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø£ÙˆÙ„Ø§Ù‹
            closeAddThingModal(); // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø£Ø¶Ù Ø´ÙŠØ¡ Ø«Ø§Ù†ÙŠØ§Ù‹
            closeReportModal(); // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            closeOptionsModal(); // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
            notificationModal.style.display = 'flex';
            body.classList.add('page-hidden');
        }

        function closeNotificationModal() {
            notificationModal.style.display = 'none';
            body.classList.remove('page-hidden');
        }

        // =================================================
        // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ Options Modal (Ø¬Ø¯ÙŠØ¯)
        // =================================================

        function openOptionsModal(e) {
            if (e) e.preventDefault();
            closeChat(null); 
            closeAddThingModal(); 
            closeNotificationModal(); 
            closeReportModal(); 
            optionsModal.style.display = 'flex';
            body.classList.add('page-hidden');
        }

        function closeOptionsModal() {
            optionsModal.style.display = 'none';
            body.classList.remove('page-hidden');
        }


        // =================================================
        // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙØªØ­ ÙˆØºÙ„Ù‚ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        // =================================================

        function openChat(e) {
            if (e) e.preventDefault();
            closeAddThingModal(); // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø£Ø¶Ù Ø´ÙŠØ¡ Ø£ÙˆÙ„Ø§Ù‹
            closeNotificationModal(); // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            closeReportModal(); // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            closeOptionsModal(); // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
            chatPopup.style.display = 'flex';
            body.classList.add('page-hidden');
            backToList(); // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
        }

        function closeChat(e) {
            if (e) e.preventDefault();
            chatPopup.style.display = 'none';
            telegramChatMessages.style.display = 'none';
            body.classList.remove('page-hidden');
        }

        // =================================================
        // Ø±Ø¨Ø· Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        // =================================================

        // 1. Ø²Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙŠÙØªØ­ Ø§Ù„Ù€ Modal Ø§Ù„Ø¬Ø¯ÙŠØ¯
        optionsToggle.addEventListener('click', openOptionsModal);

        // 2. Ø±Ø¨Ø· Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ø§Ù„Ù€ Options Modal
        messagesLinkOptions.addEventListener('click', openChat); 
        addThingOptionsBtn.addEventListener('click', openAddThingModal); 
        reportLinkOptions.addEventListener('click', openReportModal); 
        
        // 3. Ø±Ø¨Ø· Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù€ Sidebar Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        messagesLinkSidebar.addEventListener('click', openChat);
        addThingSidebarBtn.addEventListener('click', openAddThingModal);
        if (notificationLinkSidebar) notificationLinkSidebar.addEventListener('click', openNotificationModal);
        if (reportLinkSidebar) reportLinkSidebar.addEventListener('click', openReportModal);

        // 4. ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        window.addEventListener('click', (event) => {
             if (event.target === chatPopup) {
                 closeChat(event);
             }
             if (event.target === addThingModal) {
                 closeAddThingModal();
             }
             if (event.target === notificationModal) {
                 closeNotificationModal();
             }
             if (event.target === reportModal) {
                 closeReportModal();
             }
             if (event.target === optionsModal) { 
                 closeOptionsModal();
             }
         });


        // =================================================
        // Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¶Ø§Ù Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Telegram-like)
        // =================================================

        // ØªÙ… ØªØ±Ùƒ Ù‚ÙŠÙ… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© ÙƒÙ…Ø§ Ù‡ÙŠ
        const CHAT_BOT_TOKEN = '8490684701:AAHUk7Ayn8RmrreRbfVLX41c5nI1EhR3CxE'; // ØªÙˆÙƒÙ† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
        const CHAT_RECEIVER_ID = '7428842238'; // Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªÙ„Ù… Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
        const CHAT_STORAGE_KEY = 'telegram_chat_owner';
        
        let currentChat = '';
        let mediaRecorder;
        let audioChunks = [];
        let recorderStartTime;
        let recordingInterval;
        let currentAttachment = null; 

        function generateUniqueId() {
            return Date.now() + Math.random().toString(36).substring(2, 9);
        }

        const initialOwnerMessages = [
            { text: 'Ø£Ù†Ø§ ÙØ®ÙˆØ± Ø¨ÙŠÙƒ Ø¬Ø¯Ø§Ù‹ ÙˆØ¨ØªÙ…Ù†Ù‰ Ù„ÙŠÙƒ Ø§Ù„ØªÙÙˆÙ‚ Ø§Ù„Ø¯Ø§Ø¦Ù… â¤', sender: 'bot', id: 'bot1' },
            { text: 'Ù†ØµÙŠØ­ØªÙŠ Ù„ÙŠÙƒ Ø¥Ù†Ùƒ ØªØ³Ø¹Ù‰ ÙˆØ±Ø§ Ø­Ù„Ù…Ùƒ Ù„Ø£Ù† Ø¯Ù‡ Ù…ØµÙŠØ± Ø­ÙŠØ§ØªÙƒ ğŸ©¶', sender: 'bot', id: 'bot2' },
            { text: 'Ø­Ø§ÙˆÙ„ ØªØ·ÙˆØ± Ù†ÙØ³Ùƒ ÙÙŠ Ø§Ù„Ø­Ø§Ø¬Ø© Ø§Ù„Ù„ÙŠ Ø¨ØªØ­Ø¨Ù‡Ø§ ÙˆØ£Ù†Ø§ Ù…Ø¹Ø§Ùƒ ğŸ¤ğŸ¥°', sender: 'bot', id: 'bot3' },
            { text: 'Ø§Ø¨Ø¹ØªÙ„ÙŠ Ø£Ø­Ù„Ø§Ù…Ùƒ ÙˆØ£Ù‡Ø¯Ø§ÙÙƒ ÙˆÙ…ØªÙ‚Ù„Ù‚Ø´ Ø£Ù†Ø§ Ù‡Ù‚Ù Ø¬Ù†Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„ ğŸ˜‰ğŸ«µ', sender: 'bot', id: 'bot4' }
        ];

        function loadChatHistory() {
            const history = localStorage.getItem(CHAT_STORAGE_KEY);
            let savedHistory = history ? JSON.parse(history) : [];
            savedHistory.forEach(msg => {
                if (!msg.id) msg.id = generateUniqueId();
            });
            return savedHistory;
        }

        function saveChatHistory(history) {
            localStorage.setItem(CHAT_STORAGE_KEY, JSON.stringify(history));
        }
        
        function showMessages(chatType, clickedElement) {
            chatPopup.style.display = 'none';
            telegramChatMessages.style.display = 'block';
            currentChat = chatType;
            
            const messageList = document.getElementById('message-list');
            messageList.innerHTML = '';
            const chatTitle = document.getElementById('chat-title');
            const inputContainer = document.getElementById('message-input-container');
            
            document.querySelectorAll('.chat-item').forEach(item => item.classList.remove('active'));
            clickedElement.classList.add('active');

            if (chatType === 'important') {
                chatTitle.textContent = 'ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù‡Ø§Ù…Ø©';
                inputContainer.style.display = 'none';
                addMessage('Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ±Ù‰ Ø£Ù† Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…ÙÙŠØ¯Ø©ØŒ ÙÙƒÙ„ Ù…Ø§ Ø¹Ù„ÙŠÙƒ Ù‡Ùˆ Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§ Ø¹Ù„Ù‰ Ø£ÙˆØ³Ø¹ Ù†Ø·Ø§Ù‚!', 'bot', true, null, null, null, 'imp1');
                addMessage('Ø±ÙˆØ§Ø¨Ø· Ù…Ù†ØµØ§Øª Ø­Ù„ØªÙ‡Ø§Ù„Ùƒ:<br>ğŸŒ Web: <a href="https://halthalk.vercel.app" target="_blank" style="color:#1D7AFC;">halthalk.vercel.app</a><br>ğŸ“± Telegram: <a href="https://t.me/Halthalkbot" target="_blank" style="color:#1D7AFC;">@Halthalkbot</a>', 'bot', true, null, null, null, 'imp2');
            } else if (chatType === 'owner') {
                chatTitle.textContent = 'Ù…Ø§Ù„Ùƒ Ù…Ù†ØµØ© Ø­Ù„ØªÙ‡Ø§Ù„Ùƒ';
                inputContainer.style.display = 'flex';
                
                const savedMessages = loadChatHistory();
                let fullHistory = [...initialOwnerMessages];
                
                const initialIds = initialOwnerMessages.map(msg => msg.id);
                const uniqueSavedMessages = savedMessages.filter(msg => !initialIds.includes(msg.id));

                fullHistory = fullHistory.concat(uniqueSavedMessages);
                
                fullHistory.forEach(msg => addMessage(msg.text, msg.sender, false, msg.attachmentType, msg.attachmentInfo, msg.attachmentUrl, msg.id));
            }
            
            messageList.scrollTop = messageList.scrollHeight;
            updateSendButton(); 
        }

        function addMessage(text, sender = 'user', autoScroll = true, attachmentType = null, attachmentInfo = null, attachmentUrl = null, msgId = null) {
            if (!msgId) msgId = generateUniqueId(); 

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === 'bot' ? 'other' : ''}`;
            messageDiv.setAttribute('data-id', msgId); 
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            const cleanText = DOMPurify.sanitize(text, {ALLOWED_TAGS: ['a', 'br', 'p', 'span'], ALLOWED_ATTR: ['href', 'target', 'style', 'class', 'title']});
            
            if (attachmentType && attachmentUrl) {
                const previewDiv = document.createElement('div');
                previewDiv.className = 'attachment-preview';
                
                if (attachmentType === 'image') {
                    previewDiv.innerHTML = `<img src="${attachmentUrl}" alt="ØµÙˆØ±Ø© Ù…ÙØ±Ø³Ù„Ø©">`;
                } else if (attachmentType === 'audio') {
                    const duration = attachmentInfo.duration || '00:00';
                    const audioClass = sender === 'bot' ? 'voice-note other' : 'voice-note';
                    
                    previewDiv.innerHTML = `
                        <audio src="${attachmentUrl}" data-duration="${duration}" style="display:none;"></audio>
                        <div class="${audioClass}">
                            <button class="voice-play-btn" data-state="play" title="ØªØ´ØºÙŠÙ„"><i class="fas fa-play"></i></button>
                            <div class="voice-timeline">
                                <div class="voice-progress"></div>
                            </div>
                            <span class="voice-duration">${duration}</span>
                        </div>
                    `;
                    setTimeout(() => {
                        const voiceNoteDiv = previewDiv.querySelector('.voice-note');
                        if(voiceNoteDiv) {
                           const audio = previewDiv.querySelector('audio');
                           const playBtn = previewDiv.querySelector('.voice-play-btn');
                           const progressDiv = previewDiv.querySelector('.voice-progress');
                           
                           setupVoiceNoteControls(audio, playBtn, progressDiv);
                        }
                    }, 0);
                    
                } else if (attachmentType === 'file' && attachmentInfo) {
                    const fileName = attachmentInfo.name || 'Ù…Ù„Ù';
                    const fileSize = attachmentInfo.size || '';

                    previewDiv.innerHTML = `
                        <div class="file-card">
                            <span class="file-card-icon"><i class="fas fa-file"></i></span>
                            <div class="file-card-info">
                                <div class="file-card-name">${fileName}</div>
                                <div class="file-card-size">Ø§Ù„Ø­Ø¬Ù…: ${fileSize}</div>
                            </div>
                            <button class="preview-file-btn" onclick="window.open('${attachmentUrl}', '_blank')">Ù…Ø¹Ø§ÙŠÙ†Ø©/ØªÙ†Ø²ÙŠÙ„</button>
                        </div>
                    `;
                }
                
                contentDiv.appendChild(previewDiv);

                if (cleanText) {
                     const textNode = document.createElement('p');
                     textNode.innerHTML = cleanText;
                     contentDiv.appendChild(textNode);
                }
            } else {
                contentDiv.innerHTML = cleanText;
            }

            if (sender === 'user') {
                const wrapper = document.createElement('div');
                wrapper.className = 'message-content-wrapper'; 
                wrapper.style.display = 'flex';
                wrapper.style.alignItems = 'flex-end';

                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>'; 
                deleteBtn.className = 'delete-btn';
                deleteBtn.title = 'Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©';
                deleteBtn.onclick = () => deleteMessage(msgId);
                
                wrapper.appendChild(deleteBtn); 
                wrapper.appendChild(contentDiv);
                
                messageDiv.appendChild(wrapper);

            } else {
                messageDiv.appendChild(contentDiv);
            }
            
            document.getElementById('message-list').appendChild(messageDiv);
            
            if (autoScroll) {
                const messageList = document.getElementById('message-list');
                setTimeout(() => {
                    messageList.scrollTop = messageList.scrollHeight;
                }, 100);
            }
        }
        
        function setupVoiceNoteControls(audio, playBtn, progressDiv) {
            
            const updateProgress = () => {
                const percent = (audio.currentTime / audio.duration) * 100;
                progressDiv.style.width = `${percent}%`;
            };
            
            const togglePlayPauseIcon = (isPlaying) => {
                playBtn.innerHTML = isPlaying ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>';
                playBtn.setAttribute('data-state', isPlaying ? 'pause' : 'play');
                playBtn.title = isPlaying ? 'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª' : 'ØªØ´ØºÙŠÙ„';
            };
            
            playBtn.addEventListener('click', () => {
                if (audio.paused || audio.ended) {
                    audio.play();
                    togglePlayPauseIcon(true);
                } else {
                    audio.pause();
                    togglePlayPauseIcon(false);
                }
            });

            audio.addEventListener('play', () => {
                togglePlayPauseIcon(true);
            });
            audio.addEventListener('pause', () => {
                togglePlayPauseIcon(false);
            });
            audio.addEventListener('timeupdate', updateProgress);
            audio.addEventListener('ended', () => {
                audio.currentTime = 0;
                togglePlayPauseIcon(false);
                progressDiv.style.width = '0%';
            });
            
            const durationSpan = playBtn.parentElement.querySelector('.voice-duration');
            audio.addEventListener('loadedmetadata', () => {
                const durationSeconds = Math.floor(audio.duration);
                const minutes = String(Math.floor(durationSeconds / 60)).padStart(2, '0');
                const seconds = String(durationSeconds % 60).padStart(2, '0');
                if (durationSpan.textContent === '00:00' || isNaN(audio.duration)) {
                    durationSpan.textContent = `${minutes}:${seconds}`;
                    if(isNaN(audio.duration)) {
                        durationSpan.textContent = '...'; 
                    }
                }
            });
            
            if (audio.readyState >= 2) { 
                 const durationSeconds = Math.floor(audio.duration);
                 const minutes = String(Math.floor(durationSeconds / 60)).padStart(2, '0');
                 const seconds = String(durationSeconds % 60).padStart(2, '0');
                 durationSpan.textContent = `${minutes}:${seconds}`;
            }
        }


        function deleteMessage(msgId) {
            const messageElement = document.querySelector(`.message[data-id="${msgId}"]`);
            if (!messageElement) return;

            messageElement.remove();

            let history = loadChatHistory();
            const initialLength = history.length;
            
            const isBotMessage = initialOwnerMessages.some(msg => msg.id === msgId);
            if (isBotMessage) return; 

            history = history.filter(msg => msg.id !== msgId);
            
            if (history.length !== initialLength) {
                saveChatHistory(history);

                const combinedHistory = [...initialOwnerMessages, ...history.filter(msg => !initialOwnerMessages.map(i => i.id).includes(msg.id))];
                const lastMessage = combinedHistory.pop();
                document.getElementById('owner-last-message').innerHTML = DOMPurify.sanitize(lastMessage ? (lastMessage.text || 'Ø±Ø³Ø§Ù„Ø© Ù…Ø±ÙÙ‚Ø©') : initialOwnerMessages[initialOwnerMessages.length - 1].text);
            }
        }

        function sendConfirmationMessage() {
            const confirmationText = 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ³ÙŠØªÙ… ØªÙÙ‚Ø¯Ù‡Ø§ Ù‚Ø±ÙŠØ¨Ø§Ù‹. Ù…Ù„Ø­ÙˆØ¸Ø©: Ù†Ø­Ù† Ù†ØªÙÙ‚Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆÙ„Ø§ Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„Ø±Ø¯ Ø¨Ø³Ø¨Ø¨ Ø³Ø±Ø¹Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø© Ø¥Ù„ÙŠÙ†Ø§ ğŸ™‚â¤ï¸â€ğŸ©¹';
            setTimeout(() => {
                addMessage(confirmationText, 'bot', true, null, null, null, generateUniqueId());
            }, 200);
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            
            if (!message || currentChat !== 'owner') return;
            
            const newMsgId = generateUniqueId();
            addMessage(message, 'user', true, null, null, null, newMsgId);
            
            const history = loadChatHistory();
            history.push({ text: message, sender: 'user', id: newMsgId }); 
            saveChatHistory(history);
            
            document.getElementById('owner-last-message').textContent = message;
            
            input.value = '';
            input.rows = 1;
            updateSendButton();
            sendTextToTelegram(message, CHAT_BOT_TOKEN, CHAT_RECEIVER_ID); 
            sendConfirmationMessage();
        }
        
        function toggleAttachmentMenu() {
            if (currentChat !== 'owner') return;
            const menu = document.getElementById('attachment-menu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        function handleAttachment(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            toggleAttachmentMenu(); 

            currentAttachment = {
                file: file,
                type: type,
                dataUrl: null,
                caption: ''
            };
            
            const reader = new FileReader();
            reader.onload = function(e) {
                currentAttachment.dataUrl = e.target.result;
                showPreviewModal();
            };
            
            if (type === 'image') {
                reader.readAsDataURL(file);
            } else {
                 showPreviewModal();
            }
            
            event.target.value = '';
        }

        function showPreviewModal() {
            const modal = document.getElementById('preview-modal');
            const placeholder = document.getElementById('preview-placeholder');
            
            placeholder.innerHTML = '';
            document.getElementById('preview-caption').value = currentAttachment.caption || '';
            
            const file = currentAttachment.file;

            if (currentAttachment.type === 'image' && currentAttachment.dataUrl) {
                placeholder.innerHTML = `<img id="preview-media" src="${currentAttachment.dataUrl}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©">`;
            } else if (currentAttachment.type === 'file') {
                const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
                const fileIcon = getFileIcon(file.type);
                placeholder.innerHTML = `<p style="color:var(--telegram-blue); text-align:center; font-size:18px;"><i class="${fileIcon}"></i> ${file.name}</p><p style="text-align:center; font-size:14px; color:var(--text-secondary);">Ø§Ù„Ø­Ø¬Ù…: ${fileSizeMB} Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª</p>`;
            } else if (currentAttachment.type === 'audio' && currentAttachment.dataUrl) {
                 const duration = currentAttachment.info ? currentAttachment.info.duration : (document.getElementById('recording-timer') ? document.getElementById('recording-timer').textContent : '00:00');
                 placeholder.innerHTML = `<audio id="preview-media" controls src="${currentAttachment.dataUrl}"></audio><p style="text-align:center; margin-top:10px; color:var(--text-light);">ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ (${duration})</p>`;
            }
            
            modal.style.display = 'flex';
        }

        function getFileIcon(mimeType) {
            if (mimeType.startsWith('image/')) return 'fas fa-image';
            if (mimeType.startsWith('video/')) return 'fas fa-video';
            if (mimeType.startsWith('audio/')) return 'fas fa-microphone';
            if (mimeType.includes('pdf')) return 'fas fa-file-pdf';
            if (mimeType.includes('zip') || mimeType.includes('rar')) return 'fas fa-file-archive';
            return 'fas fa-file';
        }

        function closePreviewModal() {
            document.getElementById('preview-modal').style.display = 'none';
            currentAttachment = null;
        }
        
        function sendAttachment() {
            if (!currentAttachment) return;

            const caption = document.getElementById('preview-caption').value.trim();
            const attachmentType = currentAttachment.type;
            const attachmentFile = currentAttachment.file;
            const attachmentUrl = currentAttachment.dataUrl || URL.createObjectURL(attachmentFile);
            
            let attachmentInfo = {};
            let displayMessage = caption;

            if (attachmentType === 'image' || attachmentType === 'file') {
                const fileSizeMB = (attachmentFile.size / (1024 * 1024)).toFixed(2);
                attachmentInfo = {
                    name: attachmentFile.name,
                    size: `${fileSizeMB} MB`
                };
                displayMessage = caption || `ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${attachmentType} (${attachmentInfo.name})`;
                
            } else if (attachmentType === 'audio') {
                const duration = currentAttachment.info ? currentAttachment.info.duration : '00:00';
                attachmentInfo = { duration: duration };
                displayMessage = caption || `ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ: ${duration}`;
            }

            const newMsgId = generateUniqueId();
            
            addMessage(caption, 'user', true, attachmentType, attachmentInfo, attachmentUrl, newMsgId); 
            
            const history = loadChatHistory();
            history.push({ 
                text: caption, 
                sender: 'user', 
                attachmentType: attachmentType, 
                attachmentInfo: attachmentInfo,
                attachmentUrl: attachmentUrl, 
                id: newMsgId 
            });
            saveChatHistory(history);
            
            document.getElementById('owner-last-message').innerHTML = DOMPurify.sanitize(displayMessage);
            
            sendFileToTelegram(attachmentFile, caption);
            sendConfirmationMessage();


            closePreviewModal();
        }

        function updateTimer() {
            const currentTime = Date.now();
            const elapsed = Math.floor((currentTime - recorderStartTime) / 1000);
            const minutes = String(Math.floor(elapsed / 60)).padStart(2, '0');
            const seconds = String(elapsed % 60).padStart(2, '0');
            document.getElementById('recording-timer').textContent = `${minutes}:${seconds}`;
        }

        async function startRecording() {
            if (currentChat !== 'owner') return;

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = () => {
                    clearInterval(recordingInterval);
                    
                    const mimeType = 'audio/webm; codecs=opus';
                    const audioBlob = new Blob(audioChunks, { type: mimeType });
                    
                    const duration = document.getElementById('recording-timer').textContent;

                    currentAttachment = {
                        file: audioBlob,
                        type: 'audio',
                        dataUrl: URL.createObjectURL(audioBlob),
                        caption: '',
                        info: { duration: duration } 
                    };
                    
                    document.getElementById('recording-indicator').style.display = 'none';
                    document.getElementById('message-input-container').style.display = 'flex';
                    
                    showPreviewModal();
                };

                mediaRecorder.start();
                
                document.getElementById('recording-indicator').style.display = 'flex';
                document.getElementById('message-input-container').style.display = 'none';

                recorderStartTime = Date.now();
                document.getElementById('recording-timer').textContent = '00:00';
                recordingInterval = setInterval(updateTimer, 1000);

            } catch (err) {
                alert('ÙØ´Ù„ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©.');
                console.error('Recording error:', err);
                document.getElementById('recording-indicator').style.display = 'none';
                document.getElementById('message-input-container').style.display = 'flex'; 
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop()); 
            }
        }
        
        async function sendTextToTelegram(text, botToken, chatId) {
            try {
                const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
                const payload = {
                    chat_id: chatId,
                    text: text,
                    parse_mode: 'Markdown' 
                };
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    console.error('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª.');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©:', error);
            }
        }

        async function sendFileToTelegram(file, caption) {
            const formData = new FormData();
            formData.append('chat_id', CHAT_RECEIVER_ID);

            let apiEndpoint;
            if (file.type.startsWith('image/')) {
                apiEndpoint = 'sendPhoto';
                formData.append('photo', file);
            } else if (file.type.startsWith('audio/')) {
                apiEndpoint = 'sendAudio';
                formData.append('audio', file);
            } else if (file.type.startsWith('video/')) {
                 apiEndpoint = 'sendVideo';
                 formData.append('video', file);
            } else {
                apiEndpoint = 'sendDocument';
                formData.append('document', file);
            }
            
            if (caption) {
                formData.append('caption', caption);
            }

            try {
                const response = await fetch(`https://api.telegram.org/bot${CHAT_BOT_TOKEN}/${apiEndpoint}`, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    console.error('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª.');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©:', error);
            }
        }


        function updateSendButton() {
            const input = document.getElementById('message-input');
            const sendBtn = document.getElementById('send-btn');
            const voiceBtn = document.getElementById('voice-btn');
            const attachmentBtn = document.getElementById('attachment-btn');
            
            const hasText = input.value.trim().length > 0;
            const isOwnerChat = currentChat === 'owner';

            attachmentBtn.style.display = isOwnerChat ? 'block' : 'none';

            if (hasText) {
                sendBtn.style.display = 'flex';
                voiceBtn.style.display = 'none';
            } else {
                sendBtn.style.display = 'none';
                voiceBtn.style.display = 'block';
            }

            sendBtn.disabled = !(hasText && isOwnerChat);
        }

        function handleKeyPress(event) {
            setTimeout(updateSendButton, 0); 
            
            setTimeout(() => {
                const input = event.target;
                const lines = input.value.split('\n').length;
                input.rows = Math.min(6, Math.max(1, lines)); 
            }, 0);

            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function backToList() {
            if (currentChat === 'owner') {
                // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ØªØ¨Ø§Ø¯Ù„Ø© ÙÙ‚Ø·)
                const history = loadChatHistory();
                const userMessages = history.filter(msg => msg.sender === 'user' || initialOwnerMessages.some(i => i.id === msg.id));
                saveChatHistory(userMessages.filter(msg => !initialOwnerMessages.map(i => i.id).includes(msg.id)));
                
                const allMsgs = [...initialOwnerMessages, ...userMessages.filter(msg => !initialOwnerMessages.map(i => i.id).includes(msg.id))];
                
                const lastMsg = allMsgs.pop();
                document.getElementById('owner-last-message').innerHTML = DOMPurify.sanitize(lastMsg ? (lastMsg.text || 'Ø±Ø³Ø§Ù„Ø© Ù…Ø±ÙÙ‚Ø©') : initialOwnerMessages[initialOwnerMessages.length - 1].text);

            }

            telegramChatMessages.style.display = 'none';
            chatPopup.style.display = 'flex';
            
            const input = document.getElementById('message-input');
            input.value = '';
            input.rows = 1; 
            updateSendButton();
            document.getElementById('attachment-menu').style.display = 'none';
        }

        // DOMPurify Mock (Ù„ØªØ¹Ù‚ÙŠÙ… Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„)
        const DOMPurify = {
            sanitize: (html, options) => {
                let tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;

                if (options && options.ALLOWED_TAGS) {
                    const allElements = tempDiv.querySelectorAll('*');
                    allElements.forEach(el => {
                        if (!options.ALLOWED_TAGS.includes(el.tagName.toLowerCase())) {
                            el.remove();
                        }
                        Array.from(el.attributes).forEach(attr => {
                            if (!options.ALLOWED_ATTR.includes(attr.name.toLowerCase())) {
                                el.removeAttribute(attr.name);
                            }
                        });
                    });
                }
                
                return tempDiv.innerHTML;
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('message-input').addEventListener('input', updateSendButton);
            
            const history = loadChatHistory();
            
            const allMsgs = [...initialOwnerMessages, ...history.filter(msg => msg.sender === 'user')];
            const lastMsg = allMsgs.length > 0 ? allMsgs.pop() : initialOwnerMessages[initialOwnerMessages.length - 1];

            document.getElementById('owner-last-message').innerHTML = DOMPurify.sanitize(lastMsg.text || 'Ø±Ø³Ø§Ù„Ø© Ù…Ø±ÙÙ‚Ø©');
            
            // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ù†ÙˆØ§ÙØ° ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© 
            closeChat(null); 
            closeAddThingModal();
            closeNotificationModal(); 
            closeReportModal(); 
            closeOptionsModal(); // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        });
    </script>
</body>
</html>
